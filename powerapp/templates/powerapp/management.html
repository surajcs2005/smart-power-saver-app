{% extends 'base.html' %}
{% block title %}Management - Smart Power Saver{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1><i class="fas fa-users-cog"></i> Users & Devices</h1>
        <div class="device-toolbar">
            <div class="toolbar-left">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input id="mgmt-search" type="text" placeholder="Search users or devices..." />
                </div>
                <select id="mgmt-room" class="form-select form-select-sm">
                    <option value="">All rooms</option>
                    <option>Living Room</option>
                    <option>Kitchen</option>
                    <option>Bedroom</option>
                    <option>Office</option>
                    <option>Laundry</option>
                </select>
            </div>
        </div>
    </div>

    <div class="panel">
        <div class="panel-header"><h2><i class="fas fa-table"></i> Devices</h2></div>
        <div class="panel-content">
            <div class="table-responsive">
                <table class="ranking-table">
                    <thead>
                        <tr><th>ID</th><th>Name</th><th>Room</th><th>Status</th><th>Actions</th></tr>
                    </thead>
                    <tbody id="mgmt-devices"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
    function load(){
        fetch('/api/devices/').then(r=>r.json()).then(j=>{
            const tbody = document.getElementById('mgmt-devices');
            tbody.innerHTML='';
            j.devices.forEach(d=>{
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${d.id}</td><td>${d.name}</td><td>${d.room||''}</td><td>${d.is_on?'On':'Off'}</td><td><button class='btn btn-sm ${d.is_on?'btn-danger':'btn-primary'}' onclick='toggleDevice(${d.id})'><i class="fas fa-power-off"></i></button></td>`;
                tbody.appendChild(tr);
            })
        })
    }
    load();
});
</script>
{% endblock %}

